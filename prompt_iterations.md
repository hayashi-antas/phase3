## Phase3｜プロンプト改善ログ（NotebookLM × AIエンジニアリング 第5章）

本ドキュメントは、『AIエンジニアリング』（Chip Huyen, 2025）第5章を題材に、  
プロンプト設計の違いが出力品質に与える影響を段階的に検証した記録である。

各 Iteration では、
- **何を狙って**
- **どのようにプロンプトを変更し**
- **どのような変化が起きたか**

を再現可能な形で残すことを目的とする。

---

## Iteration 0｜ベースライン（指示なし）

### 狙い
最小限の指示で、モデルがどのような要約を生成するかを確認する。

### プロンプト設計
- ロール指定：なし  
- 制約条件：なし  
- 目的：純粋なベースライン取得

<details>
<summary>▶ 実際に使用したプロンプト</summary>

```text
「AIエンジニアリング」の第5章を要約してください。
````

</details>

<details>
<summary>▶ NotebookLM の出力（要約全文）</summary>
『AIエンジニアリング』の第5章は「**プロンプトエンジニアリング**」と題されており、モデルの重みを変更せずに、望ましい結果を生成するようにAIモデルへ指示を設計するプロセスについて包括的に解説しています,。

以下に、第5章の主要な論点をまとめます。

### 5.1 プロンプト入門

*   **プロンプトの構成要素:**
    プロンプトは、モデルに実行させたい内容（タスクの説明、役割、望ましい出力形式など）、タスクの実行方法の例、そして具体的なタスク（質問、要約対象のテキストなど）の要素で構成されます,。
*   **Zero-shotとFew-shot学習:**
    プロンプト内の例からモデルに学習させることは**コンテキスト内学習**と呼ばれます,。例を全く含まない場合はZero-shot学習、いくつかの例を含む場合はFew-shot学習と呼ばれます,。モデルが強力になるにつれて、Few-shot学習による性能向上の効果は限定的になることが示唆されています,。
*   **システムプロンプトとユーザープロンプト:**
    多くのモデルAPIでは、プロンプトをシステムプロンプト（アプリケーション開発者が用意する指示）とユーザープロンプト（ユーザーが入力する具体的なタスク）に分割するオプションがあります,。システムプロンプトに特定の役割や人格を割り当てることで、モデルがより効果的にそのキャラクターを維持し、自然で創造的な応答を示すことができます,。
*   **チャットテンプレートの重要性:**
    システムプロンプトとユーザープロンプトは、モデルの**チャットテンプレート**に従って1つのプロンプトに結合されます,。**誤ったテンプレートの使用は、不可解なパフォーマンス低下やサイレントエラーを引き起こす可能性がある**ため、使用するテンプレートがモデルの形式に厳密に従っていることを確認する必要があります,。
*   **コンテキスト長:**
    プロンプトに含められる情報の量は、モデルの**コンテキスト長**によって制限されます,。コンテキスト長は近年急速に拡大していますが、モデルはプロンプトの中央部よりも、**最初と最後に与えられた指示をはるかにうまく理解する**ことが研究で示されています,。

### 5.2 プロンプトエンジニアリングのベストプラクティス

効果的なプロンプトを作成するための普遍的な戦略として、以下の点が挙げられます。

*   **明確で具体的な指示:**
    モデルに何をさせたいか（ペルソナ、採点システムなど）を曖昧さなく説明し、**例を示す**ことで、モデルに期待する応答を明確に伝えることができます,,。
*   **コンテキストの提供:**
    関連性の高い情報（コンテキスト）をプロンプトに含めることで、応答の質を向上させ、**ハルシネーションを軽減**できます,。
*   **複雑なタスクの分割:**
    複数のステップを要する複雑なタスクは、単純なサブタスクに分割し、それぞれに専用のプロンプトを与えることで、パフォーマンスの向上、監視・デバッグの容易化、そして並列化によるレイテンシー削減のメリットが得られます,。
*   **モデルに考える時間を与える:**
    **Chain-of-Thought（CoT）**や**自己批判（self-critique）**プロンプティングを用いることで、モデルに段階的に考えるよう促し、推論能力と問題解決の精度を向上させることができます,,。
*   **プロンプトの整理とバージョン管理:**
    プロンプトをコードから分離し、**プロンプトカタログ**でバージョン管理することで、共同作業やテスト、保守が容易になります,。

### 5.3 防御的プロンプトエンジニアリング

プロンプト攻撃からアプリケーションを防御するための対策が論じられています。攻撃は主に3種類あります。

1.  **プロンプト抽出（リバースプロンプトエンジニアリング）:**
    アプリケーションのシステムプロンプトを推測し、複製や悪用を試みる行為です,。システムプロンプトは、モデルを誘導して復唱させるなどの手法で抽出される可能性があります,。
2.  **ジェイルブレイクとプロンプトインジェクション:**
    モデルの安全機能を回避し、悪意のある指示（例：有害なコンテンツの生成、不正なアクションの実行）をモデルに実行させる試みです,。
3.  **情報抽出:**
    モデルの学習データやコンテキストから、プライベートな情報や機密情報、著作権で保護されたデータを引き出す行為です,。

これらの攻撃に対する防御策は、モデル、プロンプト、システムレベルで実施されます。

*   **モデルレベルの防御:**
    OpenAIが導入した**指示の階層**のように、システムプロンプトをユーザープロンプトよりも優先するようにモデルをファインチューニングすることで、プロンプト攻撃を防ぐことができます,。
*   **プロンプトレベルの防御:**
    モデルに「してはならないこと」を明確に指示したり、システムプロンプトを繰り返してモデルにタスクを再認識させることで、プロンプトの堅牢性を高められます,。
*   **システムレベルの防御:**
    書き込みアクションなどの影響の大きいコマンドを人間による承認なしに実行させない、入力と出力の両方にガードレールを設けて機密情報や有害なコンテンツをフィルタリングする、といったシステム的な防御が不可欠です,。

</details>

### 観察・気づき

* 章構成（5.1〜5.3）に沿った網羅的な要約
* 専門用語は拾えているが、情報量が多く要点が掴みにくい
* 読み手や用途が想定されていない

---

## Iteration 1｜ロール指定による再構成

### 狙い

読み手を明確にすることで、情報の取捨選択と語調がどう変化するかを確認する。

### プロンプト設計

* ロール：入社1〜2年目エンジニア向け解説者
* 制約条件：なし
* 期待効果：重要点の抽出・実務視点の付加

<details>
<summary>▶ 実際に使用したプロンプト</summary>

```text
あなたは、入社1〜2年目のエンジニアに向けて技術書の内容を解説する立場です。
『AIエンジニアリング』の第5章について、
「この章で特に重要なポイント」が伝わるように要約してください。
```

</details>

<details>
<summary>▶ NotebookLM の出力（要約全文）</summary>

皆さん、こんにちは。AIエンジニアリングチームへようこそ。今日は、皆さんがこれからAIアプリケーションを構築する上での基盤となる、**『AIエンジニアリング』の第5章「プロンプトエンジニアリング」**の最重要ポイントを解説します。

プロンプトエンジニアリングは、モデルの重みを変更せず、指示だけでモデルの振る舞いを調整する、**最も基礎的かつ費用対効果の高いモデル適応技術**です。しかし、その手軽さゆえに「誰でもできる」と誤解されがちですが、安定したプロダクトを開発するには、工学的な視点が不可欠です。

特に1〜2年目のエンジニアの皆さんがプロダクション環境で「事故」を起こさないために、この章で押さえるべき重要ポイントを3点に絞って解説します。

---

### 1. 基礎と堅牢性：サイレントエラーを避ける

皆さんが書くコードと同じように、プロンプトも「設計図」です。しかし、基盤モデルは驚くほど繊細であり、プロンプトのわずかな違い（例：改行、大文字小文字の変更）で応答が劇的に変わる**「堅牢性の低さ」**が存在します。

最も避けるべき設計ミスは、モデル固有の**「チャットテンプレート」を誤って使用すること**です。

*   **テンプレートの不一致はサイレントエラーの原因：** システムプロンプトやユーザープロンプトは、モデルが定義する特定のテンプレートに従って結合されます。このテンプレートが間違っていると、モデルが一見妥当な動作をしてしまう**「サイレントエラー」**を引き起こし、バグの特定を困難にします。
*   **アクション:** モデルに渡す**最終的なプロンプトの形式が、そのモデルのチャットテンプレートに厳密に従っているか**を必ず検証する習慣を身につけてください。

### 2. モデルの能力を引き出すための設計原則

モデルの品質を向上させる鍵は、プロンプトを通じてモデルのポテンシャルを最大限に引き出すことです。

*   **考える時間を与える（CoT）：** モデルの性能を向上させる最も簡単な方法の一つは、**「段階的に考えてください」**といった指示をプロンプトに加えることです。この**Chain-of-Thought（CoT）**プロンプティングにより、モデルはより体系的なアプローチを取り、**推論能力と問題解決の精度が向上します**。
*   **タスクを分割して工学的メリットを得る：** 複雑なタスクを**単純なサブタスクに分割**してください。これは、パフォーマンス向上に役立つだけでなく、工学的な利点があります。例えば、監視やデバッグが容易になり、**サブタスクの並列実行によるレイテンシーの削減**が可能になります,。
*   **指示の体系化と管理：** ロール（ペルソナ）や期待される出力形式（JSONなど）といったタスクの説明は、**システムプロンプト**として明確に記述することが推奨されています,。また、プロダクトの安定性と共同作業の容易さのため、プロンプトをコードから分離し、**プロンプトカタログでバージョン管理**するべきです。

### 3. 防御的エンジニアリング：セキュリティ確保が最優先

モデルが指示に従う能力を持つからこそ、悪意のある攻撃者がモデルに不正な指示を実行させようとする**プロンプト攻撃**（ジェイルブレイクやプロンプトインジェクション）に対して脆弱になります。

*   **間接的プロンプトインジェクションのリスク：** 特に注意が必要なのは、RAG（検索拡張生成）やエージェントのように外部ツールやデータソースを使うシステムです。攻撃者は、モデルが検索・取得する**外部コンテキストに悪意ある指示を埋め込み**（間接的プロンプトインジェクション）、機密データの抽出や不正なコード実行を試みます,,。
*   **防御の原則：人間による明確な承認：** データベースの更新やメール送信といった**「書き込みアクション」**など、システムに大きな影響を与えるコマンドについては、モデルの応答を信頼せず、**人間による明確な承認（ヒューマン・イン・ザ・ループ）**を必須とすることが不可欠です。
*   **モデルとプロンプトの階層的防御：** OpenAIが導入しているように、システムプロンプトの指示をユーザープロンプトよりも優先させる**「指示の階層」**という防御メカニズムも登場しています。これはモデルレベルでの防御策ですが、最終的な防御は、入力・出力の両方にガードレールを設ける**システムレベルの設計**にかかっています。

</details>

### 観察・気づき

* 情報が「重要度」で整理され始めた
* セキュリティ・堅牢性など実務的な論点が前面に出た
* 一方で、網羅性はやや低下

---

## Iteration 2｜制約追加による品質安定化

### 狙い

社内共有・説明資料として再利用可能な品質に安定させる。

### プロンプト設計

* ロール：入社1〜2年目エンジニア向け
* 制約：

  * 見出し＋箇条書き
  * 実務上の注意点を含める
  * 原文にない推測をしない

<details>
<summary>▶ 実際に使用したプロンプト</summary>

```text
あなたは、入社1〜2年目のエンジニア向けに技術書を解説する立場です。
『AIエンジニアリング』第5章の最重要ポイントを要約してください。

【制約条件】
- 見出しと箇条書きを用いる
- 実務で注意すべき点を必ず含める
- 原文にない内容は推測しない
```

</details>

<details>
<summary>▶ NotebookLM の出力（要約全文）</summary>
AIエンジニアリングチームへようこそ。入社1〜2年目の皆さんにとって、プロンプトエンジニアリングは、これからAIアプリケーションを開発する上での**最も基礎的で費用対効果の高い技術**となります。モデルの重みを調整するファインチューニングとは異なり、プロンプトだけでモデルの振る舞いをコントロールする技術です。

この章で学ぶべき最重要ポイントは、単に「うまいプロンプト」を書くことではなく、**信頼性と安全性を担保する「工学的なアプローチ」**を身につけることです。

以下に、『AIエンジニアリング』第5章「プロンプトエンジニアリング」の最重要ポイントを解説します。

---

### 1. 基礎技術とプロンプトの堅牢性の確保

プロンプトエンジニアリングが機能するのは、基盤モデルがプロンプト内の指示（例やタスクの説明）から学習し、特定の振る舞いを引き出せる**「コンテキスト内学習」**の能力を持っているからです。

実務で信頼性の低いプロダクトを作らないために、以下の点を徹底してください。

*   **モデル固有のチャットテンプレートを厳守する（実務上の最重要注意点）**
    *   システムプロンプトやユーザープロンプトは、モデル固有の**チャットテンプレート**に従って1つのプロンプトに結合されます。
    *   このテンプレートを誤って使用すると、**不可解なパフォーマンス低下やサイレントエラー**を引き起こす可能性があるため、利用するモデルの形式に厳密に従っていることを必ず確認してください。
*   **指示の配置を最適化する**
    *   モデルは、プロンプトの**中央部よりも、最初と最後に与えられた指示をはるかにうまく理解する**ことが研究で示されています。
    *   また、プロンプトのわずかな違い（例：改行、大文字小文字の変更）でモデルの応答が劇的に変わる**「堅牢性の低さ」**があるため、プロンプトの小さな変更にも注意を払い、テストが必要です。

### 2. モデルの推論能力と効率性を引き出す設計原則

モデルの基本性能を最大限に引き出し、同時に効率的な運用を実現するための設計原則です。

*   **モデルに「考える時間」を与える（Chain-of-Thought, CoT）**
    *   モデルに**「段階的に考えてください」**といった指示（CoT）を与えることで、問題解決に対する体系的なアプローチを取らせることができ、**推論能力と問題解決の精度が向上します**,。
*   **複雑なタスクはサブタスクに分割する**
    *   複雑なタスクを単純なサブタスクに分割すると、**パフォーマンスが向上する**だけでなく、**監視やデバッグが容易**になり、独立したステップを**並列実行することでレイテンシーを削減**できるメリットがあります,,。
*   **プロンプトをコードから分離し体系的に管理する**
    *   プロンプトをコードから分離し、**プロンプトカタログ**でバージョン管理することは、**共同作業やテストを容易にする**ための良い習慣です,。

### 3. 防御的エンジニアリング：プロンプト攻撃からの防御

AIアプリケーションを公開すると、悪意のある攻撃者によって不正な指示（ジェイルブレイクやプロンプトインジェクション）を実行させられるリスクが生じます。特に、外部ツール連携機能を持つエージェント的なアプリケーションではリスクが高まります。

*   **間接的プロンプトインジェクションのリスクを認識する（実務上の最重要注意点）**
    *   攻撃者は、RAG（検索拡張生成）の検索結果など、**モデルが利用する外部コンテキストに悪意のある指示を埋め込む**（間接的プロンプトインジェクション）ことがあります,。これにより、モデルが機密データの抽出や、不正なSQLクエリの実行といった**リモートコード実行**を引き起こす危険性があります,。
*   **防御策はシステムレベルで講じる**
    *   プロンプトの堅牢性を高める（例：システムプロンプトを繰り返す）ことも有効ですが、最も重要なのはシステムレベルの防御です。
    *   特にデータベース更新やメール送信といった影響の大きい**書き込みアクション**を含むコマンドは、**人間による明確な承認（ヒューマン・イン・ザ・ループ）なしに実行させてはなりません**。
    *   モデルが**システムプロンプトの指示をユーザープロンプトよりも優先する**よう学習させることで、多くの攻撃を防ぐことができます,。

---

プロンプトエンジニアリングは、試行錯誤のプロセスです。場当たり的な調整に終始するのではなく、プロンプトの変更を**評価指標と評価データセット**を用いて**体系的にテスト**する、エンジニアリングのアプローチを採用してください,。これが、信頼性の高いAIプロダクトを構築するための鍵となります。

</details>

### 観察・気づき

* 語調・粒度・構造が安定
* 社内オンボーディング資料として使用可能な品質
* 防御的プロンプトエンジニアリングの重要性が明確化

---

## Iteration 3｜検証・レビュー（CoTの裏利用）

### 狙い

要約内容が原文と整合しているかを検証し、誤解や抜け漏れを防ぐ。

### プロンプト設計

* 目的：品質検証専用
* 特徴：長いCoT指示を避け、観点のみを明示

<details>
<summary>▶ 実際に使用した検証プロンプト</summary>

```text
以下の要約をレビューしてください。

・第5章の主張と矛盾していないか
・重要な概念の抜け漏れがないか
・誤解を生む表現や推測がないか

問題点と改善提案を簡潔に示してください。
```

</details>

<details>
<summary>▶ NotebookLM のレビュー結果（全文）</summary>
ご提示いただいた要約（『AIエンジニアリング』第5章「プロンプトエンジニアリング」の解説）について、指定された観点からレビューしました。

### レビュー結果

| 観点 | 評価 | 根拠と詳細 |
| :--- | :--- | :--- |
| **第5章の主張との矛盾** | **矛盾なし** | 要約は、プロンプトエンジニアリングを「最も基礎的かつ費用対効果の高いモデル適応技術」と位置づけ、その上で「工学的な視点」の重要性を強調しており、第5章の主張やトピック（ベストプラクティス、防御的エンジニアリングなど）と整合しています,,,。 |
| **重要な概念の抜け漏れ** | **ほぼ網羅** | 第5章の主要な論点（チャットテンプレートの重要性、CoT、タスク分割、防御的エンジニアリング、システムプロンプトの役割など）は適切に取り上げられています,,,,,。ただし、以下の微細な概念の言及を強化すると、さらに包括的になります。 |
| **誤解を生む表現や推測** | **推測なし** | 原文にない推測や誤解を招く表現は見当たりませんでした。全ての記述がソースの内容に基づいています–。 |

---

### 問題点と改善提案

要約は非常に優れており、特に「実務で注意すべき点」として「チャットテンプレートの厳守」と「書き込みアクションの人間による承認」を強調している点は、実務的な解説として効果的です。

より包括的で精度の高い要約にするために、以下の2点について改善を提案します。

#### 1. 概念の包括性を高める（Minor Leakage）

**問題点:**
「プロンプト入門」のセクションで言及されている、**コンテキスト長**に関する重要な知見が、要約文内で明示的に触れられていません。

**原文の重要な概念:**
モデルは、プロンプトの**中央部よりも、最初と最後に与えられた指示をはるかにうまく理解する**という研究結果がある点です,。この知見は、システムプロンプトやタスクの説明の配置戦略の根拠となっています。

**改善提案:**

*   「基礎と堅牢性」のセクションに、プロンプト内の**情報の位置（コンテキスト長）**の重要性に関する記述を追加してください。
    *   例：「**コンテキスト長が長くなっても、モデルはプロンプトの最初と最後に与えられた指示を最もよく理解する**傾向があります。この特性を考慮して、重要な指示（システムプロンプトなど）を適切に配置することが推奨されます。」

#### 2. 定義の明確化（Enhancement of Definition）

**問題点:**
「Chain-of-Thought（CoT）」の説明がやや簡潔であるため、聞き手のエンジニアが「考える時間を与える」とは具体的に何であるかを理解しやすくするために、定義を補強するとより良いでしょう。

**原文の重要な概念:**
CoTは「**問題解決に対してより体系的なアプローチを取るよう導く手法**」であり、モデルに「**段階的に考えるように明示的に指示する**」ものです。

**改善提案:**

*   CoTに関する記述に、「段階的に考えるよう指示することで、モデルに**問題解決に対する体系的なアプローチ**を取らせる手法」であることを明記してください。

---

### 全体評価

この要約は、入社1〜2年目のエンジニアに対して、第5章で最も重要かつ実務上のリスクに関わる内容（堅牢性、セキュリティ、効率化）を効果的に伝達しており、**非常に質の高い解説**となっています。上記は要約の完成度をさらに高めるための微調整に過ぎません。

</details>

### 観察・気づき

* 主張との矛盾なし
* コンテキスト長に関する知見が軽微に不足していると指摘
* CoTの定義補強により完成度が向上

---

## 総括（学び）

* ロール指定は「情報の意味付け」に強く影響する
* 制約条件は出力品質を安定させる
* 検証目的では、**短く明確なプロンプトの方が有効**
* プロンプト設計は、環境制約（入力長）も含めたエンジニアリングである

---
## 「AIエンジニアリング」第5章の重要な点を表形式で出力

<details>
<summary>▶ 実際に使用した検証プロンプト</summary>

```text
あなたは、AIを活用したソフトウェア開発をこれから本格的に行う
エンジニア（実務経験1〜2年目）を支援する立場です。

NotebookLMに読み込まれている
『AIエンジニアリング』（Chip Huyen, 2025）
**第5章「プロンプトエンジニアリング」**の内容のみを根拠として、

AI活用開発において役立つテクニック、考え方、参考情報を整理してください。

【目的】
- 第5章の知見を、実際の開発時に「見返してすぐ使える」形に落とすこと

【制約条件】
- 第5章に書かれている内容のみに基づいて整理すること
- 他章や一般的な知識からの推測・補完は行わないこと
- 実務での活用イメージが分かるようにすること

【出力形式】
以下の列を持つ表形式（スプレッドシート想定）で出力してください。

- カテゴリ  
  （例：プロンプト設計 / 品質検証 / セキュリティ / 運用）
- テクニック・知見の名称  
- 概要（第5章で述べられている内容を簡潔に）
- 開発で使う場面（具体例）
- 参考情報  
  （第5章内で言及されている節・概念名など）
- 注意点・落とし穴（第5章で指摘されているもの）

【補足】
- 行数は重要なものを優先し、網羅よりも実用性を重視する
- 曖昧な場合は「第5章では明示されていない」と記載する

```

</details


AIを活用したソフトウェア開発を本格的に開始される入社1〜2年目のエンジニアの皆様へ、『AIエンジニアリング』の第5章「プロンプトエンジニアリング」の知見に基づき、実務で特に重要となるテクニック、考え方、および留意事項を以下の表に整理しました。

| カテゴリ | テクニック・知見の名称 | 概要（第5章で述べられている内容を簡潔に） | 開発で使う場面（具体例） | 参考情報（第5章内で言及されている節・概念名など） | 注意点・落とし穴（第5章で指摘されているもの） |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **設計/運用** | モデル固有のチャットテンプレートの厳守 | システムプロンプトとユーザープロンプトを結合し、モデルに入力する際の、**モデル開発元が定義した特定の形式（チャットテンプレート）**に厳密に従うこと,。 | 外部APIやオープンソースモデル（Llamaなど）を使用する際、プロンプトに**余分な改行や特殊トークンの誤りがないか**を検証する。 | 5.1.2 システムプロンプトとユーザープロンプト | **誤ったテンプレートの使用は、不可解なパフォーマンス低下やサイレントエラーを引き起こす可能性がある**。 |
| **プロンプト設計** | Chain-of-Thought (CoT) プロンプティングの活用 | モデルに**「段階的に考えてください」**と明示的に指示し、体系的なアプローチを取らせることで、推論能力と問題解決の精度を向上させる。 | 複雑な論理や計算を伴うタスク（例：データ分析、数学問題）の応答品質を向上させ、ハルシネーションを低減する,。 | 5.2.4 モデルに考える時間を与える | モデルが複数の中間ステップを実行するため、ユーザーが**最初のトークンを目にするまでのレイテンシーが増加する**可能性がある。 |
| **プロンプト設計** | 複雑なタスクのサブタスクへの分割 | 複数のステップが必要なタスクを単純なサブタスクに分解し、それぞれに専用のプロンプトと、個別の（より安価な）モデルを割り当てる,。 | カスタマーサポートで、顧客リクエストの**意図分類**と、その意図に基づく**応答生成**を別々のステップとして処理する。 | 5.2.3 複雑なタスクをより単純なサブタスクに分割する | モデルへの問い合わせ回数が増えるため、ユーザーが感じる**レイテンシーが増加する**可能性がある（ただし、並列実行で削減も可能）。 |
| **プロンプト設計** | 重要な指示の最適配置（コンテキスト効率） | モデルは、プロンプトの**中央部よりも、最初と最後に与えられた指示をはるかにうまく理解する**という知見を活用する。 | システムプロンプトやロール定義、重要な制約（例：出力形式）をプロンプトの先頭または末尾に配置する。 | 5.1.3 コンテキスト長とコンテキスト効率 | 長いプロンプトの場合、**情報を見失う可能性**があり、コンテキスト長を拡張してもモデルがコンテキストをうまく利用できない可能性がある,。 |
| **設計/運用** | プロンプトの整理とバージョン管理 | プロンプトをアプリケーションのコードから分離し、**プロンプトカタログ**でバージョン管理を行う,。 | 異なるアプリケーションで同じプロンプトを再利用する際や、共同開発者がプロンプトの変更履歴を追跡しやすくする,。 | 5.2.7 プロンプトの整理とバージョン管理 | プロンプトをコードと一緒にGitでバージョン管理すると、特定のアプリケーションが古いバージョンのプロンプトを使い続けることが困難になる。 |
| **セキュリティ** | 影響の大きいコマンドへの人間による承認 | データベースの更新やメール送信といった**書き込みアクション**を実行する際、人間の明確な承認（Human-in-the-loop）を必須とする。 | AIエージェントに本番環境のデータベースアクセス権を与える場合、「DELETE」や「UPDATE」クエリの実行前に必ず人による承認を挟む。 | 5.3.4.3 システムレベルの防御 | **プロンプトハックのリスクを完全に排除することはできない**ため、システムの能力とセキュリティ対策への信頼が不可欠である。 |
| **セキュリティ** | 悪意ある情報への防御策（指示の階層） | モデルがシステムプロンプトの指示（例：個人情報を返さない）を、**ユーザープロンプトやツールの出力よりも優先**するように学習させる,。 | 外部データソース（RAGなど）やWeb検索結果に悪意のある指示（**間接的プロンプトインジェクション**）が埋め込まれた場合に、その指示を拒否させる,。 | 5.3.4.1 モデルレベルの防御 | 堅牢性を高めるために指示を繰り返すと、**コストとレイテンシーが増加する**（トークン数が2倍になるなど）,。 |
| **プロンプト設計** | ロールプレイと出力フォーマットの明確な指定 | モデルに**ペルソナ**（例：経験豊富な不動産業者）を与える、または**期待される出力形式**（例：JSON形式、特定の採点システム）を曖昧さなく説明する,。 | モデルに特定の役割（例：小学1年生の先生）の視点で回答させる、または後続のアプリケーションで解析可能な**JSONや正規表現**に従った出力を生成させる,,。 | 5.2.1 明確で具体的な指示を書く / 5.2.1.2 / 5.2.1.4 | 不明確な採点システムや出力形式は、曖昧なスコアや**不正なフォーマット**の出力につながり、アプリケーションの信頼性を損なう,。 |

---
[独り言]
よくまとまっており、日本語も自然になっている。制約を与えることで質が上がるというのは、人間でもよくあることだが、機械でも当てはまることを確認。自分がどのような立場であり、なにを欲しているのかによって、制約条件を考えると求める結果が出やすいのだろう。ただ本を一通り読んだ身としては、細かいが面白いところとかが省かれているので、率直に言うと読んでいてつまらないのである。原文を読むのが一番だろうが、やはり時間がないとか面倒くさいとかで要約や概要だけをかいつまんで知りたいときにはいいだろう。ただAIには欲望がない。私には欲望がある。なので私の欲望を伝えて、私が満足するような応えを提出させるようにすると面白いかも。とか、まあ、とりあえず、勉強にはなる。なるのだが、実際の著者と対話しているようなコミュニケーションというものが省かれているので、さみしく感じるし、本を時間かけて読む、というその価値はいささかも減じてはないことを言いたいのだ。これは私が本好きで、元書店員だということに強く影響されていることは言うまでもない。

